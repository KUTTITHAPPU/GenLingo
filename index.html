<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GenLingo Responsive</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --blue: #0074D9; --navy: #001f3f; --green: #2ECC40; --red: #FF4136; --silver: #f4f7f6; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--silver); margin: 0; padding: 10px; padding-bottom: 80px; } /* Space for bottom bar */
        
        .main-card { max-width: 800px; margin: 0 auto; background: white; padding: 15px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--navy); font-size: 24px; margin: 10px 0; }

        /* Top Controls: Photo, PDF, Language */
        .top-tools { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .btn-small { padding: 12px; border: none; border-radius: 10px; font-weight: bold; color: white; background: var(--navy); display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 14px; }
        .lang-select { grid-column: span 2; padding: 12px; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; font-weight: bold; width: 100%; background: #fff; }

        /* Stacked Boxes */
        .box-container { display: flex; flex-direction: column; gap: 15px; }
        .label-text { font-weight: 800; color: var(--navy); font-size: 12px; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        
        textarea, .mirror-div { 
            width: 100%; height: 220px; border-radius: 12px; border: 1px solid #ddd; 
            padding: 15px; font-size: 16px; background: white; line-height: 1.6; resize: none; outline: none;
        }
        .mirror-div { position: relative; overflow-y: auto; border: 2px solid #eef2f7; }

        /* Floating Bottom Action Bar */
        .bottom-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: white; padding: 12px 20px; 
            display: flex; gap: 10px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 100;
        }
        .btn-main { flex: 2; padding: 15px; border-radius: 12px; border: none; color: white; font-weight: bold; font-size: 16px; background: var(--blue); }
        .btn-icon { flex: 0.5; padding: 15px; border-radius: 12px; border: none; color: white; font-weight: bold; background: var(--green); display: flex; align-items: center; justify-content: center; }

        /* Spinner */
        .loader { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .spinner { width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid var(--blue); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="main-card">
        <h1>GenLingo</h1>

        <div class="top-tools">
            <label class="btn-small">üì∑ Photo <input type="file" id="imgFile" accept="image/*" hidden></label>
            <label class="btn-small">üìÇ PDF <input type="file" id="pdfFile" accept="application/pdf" hidden></label>
            <select id="userLang" class="lang-select">
                <option value="hi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                <option value="ml">Malayalam (‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç)</option>
                <option value="ta">Tamil (‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç)</option>
                <option value="te">Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</option>
                <option value="kn">Kannada (‡≤ï‡≤®‡≥ç‡≤®‡≤°)</option>
            </select>
        </div>

        <div class="box-container">
            <div>
                <div class="label-text">Source Text (English)</div>
                <textarea id="sourceInput" placeholder="Type or scan text..."></textarea>
            </div>

            <div>
                <div class="label-text">Translation</div>
                <div class="mirror-div">
                    <div id="loadingUI" class="loader"><div class="spinner"></div></div>
                    <span id="translatedContent">...</span>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-bar">
        <button class="btn-icon" style="background:var(--red)" onclick="location.reload()">üîÑ</button>
        <button class="btn-main" onclick="startTranslation()">Translate Now</button>
        <button class="btn-icon" onclick="speakText()">üîä</button>
        <button class="btn-icon" style="background:var(--blue)" onclick="downloadPDF()">üì•</button>
    </div>

    <script>
        // Logic remains the same as your functional build
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
        const source = document.getElementById('sourceInput');
        const target = document.getElementById('translatedContent');
        const loader = document.getElementById('loadingUI');

        async function startTranslation() {
            const text = source.value.trim();
            const lang = document.getElementById('userLang').value;
            if(!text) return;
            loader.style.display = "block";
            target.innerText = "";
            try {
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${lang}`);
                const data = await res.json();
                target.innerText = data.responseData.translatedText;
            } catch (e) { target.innerText = "Error!"; }
            loader.style.display = "none";
        }

        function speakText() {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(target.innerText);
            utterance.lang = document.getElementById('userLang').value + "-IN";
            window.speechSynthesis.speak(utterance);
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(doc.splitTextToSize(target.innerText, 180), 10, 20);
            doc.save("GenLingo.pdf");
        }

        document.getElementById('imgFile').onchange = async (e) => {
            source.value = "Scanning...";
            const { data: { text } } = await Tesseract.recognize(e.target.files[0], 'eng');
            source.value = text;
        };

        document.getElementById('pdfFile').onchange = async (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = async function() {
                const pdf = await pdfjsLib.getDocument({data: new Uint8Array(this.result)}).promise;
                let fullText = "";
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    fullText += content.items.map(s => s.str).join(" ") + " ";
                }
                source.value = fullText;
            };
            reader.readAsArrayBuffer(file);
        };
    </script>
</body>
</html>
